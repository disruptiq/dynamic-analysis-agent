"""
Main vulnerability scanning orchestrator for the Dynamic Analysis Agent.
"""

from .vulnerability_scanner.sql_injection import test_sql_injection
from .vulnerability_scanner.command_injection import test_command_injection
from .vulnerability_scanner.xxe import test_xxe
from .vulnerability_scanner.ssrf import test_ssrf
from .vulnerability_scanner.csrf import test_csrf
from .vulnerability_scanner.broken_auth import test_broken_authentication
from .vulnerability_scanner.sensitive_data import test_sensitive_data_exposure
from .vulnerability_scanner.broken_access import test_broken_access_control
from .vulnerability_scanner.security_misconfig import test_security_misconfiguration
from .vulnerability_scanner.known_vulns import test_known_vulnerabilities
from .vulnerability_scanner.insufficient_logging import test_insufficient_logging
from .vulnerability_scanner.race_conditions import test_race_conditions
from .vulnerability_scanner.buffer_overflow import test_buffer_overflow
from .vulnerability_scanner.format_string import test_format_string
from .vulnerability_scanner.ldap_injection import test_ldap_injection
from .vulnerability_scanner.xpath_injection import test_xpath_injection
from .vulnerability_scanner.nosql_injection import test_nosql_injection
from .vulnerability_scanner.graphql_injection import test_graphql_injection
from .vulnerability_scanner.template_injection import test_template_injection
from .vulnerability_scanner.ssti import test_ssti
# from .vulnerability_scanner.file_upload import test_file_upload_vulnerabilities  # Temporarily disabled
from .vulnerability_scanner.hpp import test_http_parameter_pollution
from .vulnerability_scanner.host_header import test_host_header_injection
from .vulnerability_scanner.http_smuggling import test_http_request_smuggling
from .vulnerability_scanner.insecure_deserialization import test_insecure_deserialization
from .vulnerability_scanner.cors import test_cors_misconfiguration
from .vulnerability_scanner.clickjacking import test_clickjacking
from .vulnerability_scanner.header_validations import test_header_validations
from .vulnerability_scanner.fuzzing import test_fuzzing
from .vulnerability_scanner.nmap_integration import test_nmap_integration

def test_vulnerabilities(base_url):
    """
    Test for comprehensive web vulnerabilities.

    Args:
        base_url (str): Base URL to test

    Returns:
        list: List of all detected vulnerabilities
    """
    all_vulnerabilities = []

    # Execute all vulnerability tests
    vulnerability_tests = [
        test_sql_injection,
        test_command_injection,
        test_xxe,
        test_ssrf,
        test_csrf,
        test_broken_authentication,
        test_sensitive_data_exposure,
        test_broken_access_control,
        test_security_misconfiguration,
        test_known_vulnerabilities,
        test_insufficient_logging,
        test_race_conditions,
        test_buffer_overflow,
        test_format_string,
        test_ldap_injection,
        test_xpath_injection,
        test_nosql_injection,
        test_graphql_injection,
        test_template_injection,
        test_ssti,
        # test_file_upload_vulnerabilities,  # Temporarily disabled
        test_http_parameter_pollution,
        test_host_header_injection,
        test_http_request_smuggling,
        test_insecure_deserialization,
        test_cors_misconfiguration,
        test_clickjacking,
        test_header_validations,
        test_fuzzing,
        test_nmap_integration
    ]

    for test_func in vulnerability_tests:
        try:
            vulnerabilities = test_func(base_url)
            all_vulnerabilities.extend(vulnerabilities)
        except Exception as e:
            # Log error but continue with other tests
            print(f"Error in {test_func.__name__}: {e}")
            continue

    return all_vulnerabilities
