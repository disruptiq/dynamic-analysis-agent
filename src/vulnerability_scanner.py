"""
Basic vulnerability scanning functions for the Dynamic Analysis Agent.
"""

import requests
from urllib.parse import urljoin

def test_vulnerabilities(base_url):
    """
    Test for common web vulnerabilities.

    Args:
        base_url (str): Base URL to test
    """
    print("\nTesting for common vulnerabilities...")

    # Test for XSS (basic)
    xss_payloads = ["<script>alert('xss')</script>", "<img src=x onerror=alert('xss')>"]
    test_endpoint = urljoin(base_url, "/search")  # Assume a search endpoint

    for payload in xss_payloads:
        try:
            params = {"q": payload}
            response = requests.get(test_endpoint, params=params, timeout=5)
            if payload in response.text:
                print(f"⚠ Possible XSS vulnerability detected with payload: {payload}")
        except:
            pass

    # Test for directory traversal
    traversal_payloads = ["../../../etc/passwd", "..\\..\\..\\windows\\system32\\drivers\\etc\\hosts"]
    test_endpoint = urljoin(base_url, "/file")  # Assume a file serving endpoint

    for payload in traversal_payloads:
        try:
            params = {"path": payload}
            response = requests.get(test_endpoint, params=params, timeout=5)
            if "root:" in response.text or "hosts" in response.text:
                print(f"⚠ Possible directory traversal vulnerability detected with payload: {payload}")
        except:
            pass

    print("Vulnerability testing completed.")
